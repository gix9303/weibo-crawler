{% extends "base.html" %}

{% block title %}当前状态{% endblock %}

{% block body %}
{% if running %}
  <h1>当前运行任务</h1>
  <p>
    {{ stop_button_html|safe }}
    <a href="{{ url_for('index') }}">返回首页</a> |
    <a href="{{ url_for('list_tasks') }}">查看所有任务</a>
  </p>
  {{ notice_html|safe }}
  <table border="1" cellspacing="0" cellpadding="4">
    <tr>
      <th>task_id</th>
      <td>
        {% if icon_class %}
          <span class="iconfont {{ icon_class }}" style="margin-right:4px;"></span>
        {% endif %}
        <a href="{{ url_for('get_task_status', task_id=data.task_id) }}">{{ data.task_id }}</a>
      </td>
    </tr>
    <tr><th>state</th><td>{{ data.state }}</td></tr>
    <tr><th>progress</th><td>{{ data.progress }}</td></tr>
    <tr><th>created_at</th><td>{{ data.created_at }}</td></tr>
    <tr><th>user_id_list</th><td>{{ data.user_id_list }}</td></tr>
  </table>
{% else %}
  <h1>当前状态</h1>
  <p>
    <a href="{{ url_for('index') }}">返回首页</a> |
    <a href="{{ url_for('list_tasks') }}">查看所有任务</a>
  </p>
  <table border="1" cellspacing="0" cellpadding="4">
    {% for k, v in data.items() %}
      {% if k == "last_task_id" and v %}
        <tr>
          <th>{{ k }}</th>
          <td>
            {% if icon_class %}
              <span class="iconfont {{ icon_class }}" style="margin-right:4px;"></span>
            {% endif %}
            <a href="{{ url_for('get_task_status', task_id=v) }}">{{ v }}</a>
          </td>
        </tr>
      {% else %}
        <tr><th>{{ k }}</th><td>{{ v }}</td></tr>
      {% endif %}
    {% endfor %}
  </table>
{% endif %}
{% endblock %}
